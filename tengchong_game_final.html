<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>è…¾å†²çš®å½±æˆ Â· éé—æ¢ç§˜é—¯å…³</title>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--ink:#e5e7eb;--muted:#9ca3af;--brand:#60a5fa;--ok:#34d399}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"PingFang SC","Microsoft YaHei";background:var(--bg);color:var(--ink)}
.wrap{max-width:1100px;margin:0 auto;padding:18px}
.card{background:var(--panel);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:14px}
h1,h2{margin:0 0 12px}
.muted{color:var(--muted);font-size:14px}
input,select,button{border-radius:12px;border:1px solid #1f2937;padding:10px 12px;background:#0b1220;color:#fff}
button{background:var(--brand);color:#09111f;font-weight:700;cursor:pointer;border:none}
button.ghost{background:#0b1220;color:#fff;border:1px solid #374151}
button:disabled{opacity:.5;cursor:not-allowed}
.badge{font-size:12px;background:#0b1220;border:1px solid #374151;padding:2px 10px;border-radius:999px;color:#cbd5e1}
.progress{display:flex;gap:4px;align-items:center;flex-wrap:wrap}
.dot{width:10px;height:10px;border-radius:50%;background:#1f2937}
.dot.on{background:linear-gradient(180deg,#a7f3d0,#10b981)}
.dot.cloud{width:8px;height:8px;margin-left:6px}
.dot.ok{background:linear-gradient(180deg,#bbf7d0,#22c55e)}
.dot.fail{background:linear-gradient(180deg,#fecaca,#ef4444)}
.gallery{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.gallery img{width:100%;height:240px;object-fit:cover;border-radius:12px;border:1px solid #374151}
.gallery .span2{grid-column:1/span 2;height:280px}
.cap{font-size:12px;color:#cbd5e1;margin:6px 2px 0}
.timeline{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:10px}
.stepSlot{min-height:72px;display:flex;align-items:center;justify-content:center;border:2px dashed #374151;border-radius:12px;color:#94a3b8;background:#0b1220}
.stepSlot.locked{opacity:.6;filter:grayscale(30%)}
.stepSlot.active{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.3) inset}
.part{user-select:none;margin:8px 0;padding:10px 12px;background:#0f172a;border:1px solid #1f2937;border-radius:12px;cursor:grab}
.partsBox{background:#0b1220;border:1px solid #374151;border-radius:16px;padding:12px}
.good{outline:2px solid var(--ok)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.info{background:#0b1220;border:1px solid #374151;border-radius:14px;padding:12px;cursor:pointer}
.info .title{font-weight:700;margin-bottom:6px}
.info .content{display:none;font-size:13px;color:#cbd5e1}
.info.learned{outline:2px solid var(--ok)}
.board{--cols:4;display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:10px}
.cardtile{height:90px;background:#0b1220;border:1px solid #374151;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700}
.cardtile.open{background:linear-gradient(135deg,#0b1220,#0f172a)}
.videoWrap{background:#0b1220;border:1px solid #374151;border-radius:16px;padding:12px}
video{width:100%;border-radius:12px;background:#000}
table{width:100%;border-collapse:collapse;font-size:14px;margin-top:8px}
th,td{border-bottom:1px solid #223;padding:8px;text-align:left}
.footer{font-size:12px;color:#9ca3af;text-align:center;margin-top:8px}
@keyframes shakeX{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-6px)}40%,60%{transform:translateX(6px)}}
.shake{animation:shakeX .35s ease}
@media (max-width:900px){.board{--cols:3}}
</style>
</head>
<body>
<div class="wrap">

  <div class="card">
    <h1>è…¾å†²çš®å½±æˆ Â· éé—æ¢ç§˜é—¯å…³</h1>
    <p class="muted">â‘ åˆ¶ä½œæ­¥éª¤ â†’ â‘¡è¯æ¡å­¦ä¹ ï¼ˆ10æ¡ï¼‰ â†’ â‘¢è®°å¿†é…å¯¹ï¼ˆéšæœº 6 æ¡ï¼Œ12 å¼ å¡ï¼‰ â†’ â‘£å¥–åŠ±è§†é¢‘ã€‚é€šå…³åè‡ªåŠ¨ä¸ŠæŠ¥äº‘ç«¯ï¼ˆé£ä¹¦ï¼‰ã€‚</p>
    <div class="progress">
      <label>æ˜µç§° <input id="name" placeholder="å¦‚ï¼šå…­ï¼ˆ3ï¼‰-29"></label>
      <label>å¹´çº§ <select id="grade"><option value="">è¯·é€‰æ‹©</option><option>ä¸€å¹´çº§</option><option>äºŒå¹´çº§</option><option>ä¸‰å¹´çº§</option><option>å››å¹´çº§</option><option>äº”å¹´çº§</option><option>å…­å¹´çº§</option></select></label>
      <label>ç­çº§ <input id="klass" placeholder="å¦‚ï¼šå…­ï¼ˆ3ï¼‰ç­"></label>
      <label>åŒæ„åŒ¿åæ•°æ® <select id="consent"><option>æ˜¯</option><option>å¦</option></select></label>
      <span class="badge">ç”¨æ—¶ï¼š<span id="time">0</span>s</span>
      <span class="badge">è¿›åº¦</span><span class="dot" id="d1"></span><span class="dot" id="d2"></span><span class="dot" id="d3"></span><span class="dot" id="d4"></span>
      <span class="badge">äº‘ç«¯ <span class="dot cloud" id="cloudDot"></span></span>
      <button id="start">å¼€å§‹</button>
      <button id="reset" class="ghost" disabled>é‡æ¥</button>
    </div>
  </div>

  <!-- å¼€åœºå±•æ¿ -->
  <div class="card" id="panel-intro">
    <h2>å¼€åœºå±•æ¿</h2>
    <div class="gallery">
      <div class="span2"><img src="æ ¡å¾½.png" alt=""><div class="cap">äº‘å—å¸ˆå¤§é™„å°ï¼šéé—è¿›æ ¡å›­ï¼Œçš®å½±æˆâ€œçœ‹å¾—è§ã€ç©å¾—èµ·ã€è¯´å¾—å‡ºâ€ã€‚</div></div>
      <div><img src="çš®å½±_æ ‘ä¸‹å¯¹å.jpg" alt=""><div class="cap">å½±çª—ï¼ˆç™½å¹•ï¼‰+èƒŒåç¯å…‰ï¼Œæ¼”å‘˜åœ¨å¹•åæ“æ†ï¼Œè§‚ä¼—åœ¨å¹•å‰çœ‹â€œå½±â€ã€‚</div></div>
      <div><img src="çš®å½±_å­¦ç”Ÿè‡ªåˆ¶.jpg" alt=""><div class="cap">é å­å¯ç”¨å¡çº¸/PPç‰‡ç†è§£ç»“æ„ä¸è¿æ¥æ–¹æ³•ã€‚</div></div>
      <div><img src="çš®å½±_å­¦ç”Ÿè¡¨æ¼”.jpg" alt=""><div class="cap">ç»†ç«¹æ†è”åŠ¨å…³èŠ‚ï¼›é”£é¼“å”¢å‘é…åˆèŠ‚å¥ã€‚</div></div>
    </div>
  </div>

  <!-- ç¬¬ä¸€å…³ -->
  <div class="card" id="panel-l1" style="display:none">
    <h2>ç¬¬ä¸€å…³ Â· åˆ¶ä½œæ­¥éª¤ï¼ˆé¡ºåºæ‹¼å›¾ï¼‰</h2>
    <div class="timeline" id="slots">
      <div class="stepSlot" data-index="0">ç¬¬1æ­¥</div>
      <div class="stepSlot locked" data-index="1">ç¬¬2æ­¥</div>
      <div class="stepSlot locked" data-index="2">ç¬¬3æ­¥</div>
      <div class="stepSlot locked" data-index="3">ç¬¬4æ­¥</div>
      <div class="stepSlot locked" data-index="4">ç¬¬5æ­¥</div>
      <div class="stepSlot locked" data-index="5">ç¬¬6æ­¥</div>
    </div>
    <div class="partsBox" id="parts"></div>
    <div><button id="to-l2" class="ghost" disabled>è¿›å…¥ç¬¬äºŒå…³ âœ</button></div>
  </div>

  <!-- ç¬¬äºŒå…³ -->
  <div class="card" id="panel-l2" style="display:none">
    <h2>ç¬¬äºŒå…³ Â· çŸ¥è¯†è¯æ¡</h2>
    <div class="grid" id="infogrid"></div>
    <div><button id="to-l3" class="ghost" disabled>å¼€å§‹ç¬¬ä¸‰å…³ âœ</button></div>
  </div>

  <!-- ç¬¬ä¸‰å…³ -->
  <div class="card" id="panel-l3" style="display:none">
    <h2>ç¬¬ä¸‰å…³ Â· è®°å¿†é…å¯¹</h2>
    <p class="muted">é…å¯¹æˆåŠŸ 6 å¯¹åè§£é”ä¸‹ä¸€å…³ã€‚</p>
    <div><span class="badge">æ­¥æ•°ï¼š<span id="moves3">0</span></span></div>
    <div class="board" id="board3"></div>
    <div><button id="to-l4" disabled>ğŸ¬ å»çœ‹å¥–åŠ±å°è§†é¢‘ âœ</button></div>
  </div>

  <!-- ç¬¬å››å…³ -->
  <div class="card" id="panel-l4" style="display:none">
    <h2>ç¬¬å››å…³ Â· å¥–åŠ±è§†é¢‘</h2>
    <div class="videoWrap">
      <video id="rewardVideo" controls playsinline webkit-playsinline preload="metadata" poster="çš®å½±_å­¦ç”Ÿè¡¨æ¼”.jpg">
        <source src="piying_reward.mp4" type="video/mp4"/>
      </video>
    </div>
    <div><button id="finalize" class="ghost" disabled>ğŸ… å®Œæˆ</button></div>
  </div>

</div>

<script>
const CLOUD_ENDPOINT = "https://piying-feishu-backend.vercel.app/api/collect";
const $=s=>document.querySelector(s);
let timeSec=0,timer=null,v_seen=false,moves=0;

function startTimer(){timeSec=0;$("#time").textContent=0;timer=setInterval(()=>$("#time").textContent=++timeSec,1000)}
function stopTimer(){clearInterval(timer);timer=null}
function showPanel(id){["panel-intro","panel-l1","panel-l2","panel-l3","panel-l4"].forEach(pid=>$("#"+pid).style.display=(pid===id?"block":"none"))}

$("#start").onclick=()=>{if($("#grade").value===""||$("#consent").value!=="æ˜¯"){alert("è¯·å¡«å†™å®Œæ•´");return}startTimer();showPanel("panel-l1")};
$("#reset").onclick=()=>{stopTimer();showPanel("panel-intro")};

// è®°å¿†é…å¯¹ç®€åŒ–
let flipped=[],matched=0;
function initL3(){flipped=[];matched=0;moves=0;$("#moves3").textContent=0;$("#to-l4").disabled=true;
  const terms=["å½±çª—","ä¸œè…”","è¥¿è…”","é”£é¼“","å”¢å‘","é å­"];
  const deck=[...terms,...terms].sort(()=>Math.random()-0.5);
  const b=$("#board3");b.innerHTML="";
  deck.forEach(term=>{const d=document.createElement("div");d.className="cardtile";d.textContent="ç¿»å¼€";d.dataset.term=term;
    d.onclick=()=>flip(d);b.appendChild(d)});
}
function flip(t){if(t.classList.contains("open")||flipped.length==2)return;t.classList.add("open");t.textContent=t.dataset.term;flipped.push(t);$("#moves3").textContent=++moves;
  if(flipped.length==2){if(flipped[0].dataset.term===flipped[1].dataset.term){matched++;flipped=[];if(matched==6)$("#to-l4").disabled=false;}
  else setTimeout(()=>{flipped.forEach(x=>{x.classList.remove("open");x.textContent="ç¿»å¼€"});flipped=[]},600);}}

$("#to-l2").onclick=()=>showPanel("panel-l2");
$("#to-l3").onclick=()=>{showPanel("panel-l3");initL3()};
$("#to-l4").onclick=()=>{showPanel("panel-l4");};

$("#rewardVideo").onplay=()=>{v_seen=true};
$("#rewardVideo").onended=()=>{$("#finalize").disabled=false};

$("#finalize").onclick=async ()=>{
  stopTimer();
  const rec={
    user: $("#name").value,
    grade: $("#grade").value,
    clazz: $("#klass").value,
    score: moves, // âœ… ç¬¬3å…³æ­¥æ•°
    watched: v_seen
  };
  try{
    const res=await fetch(CLOUD_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(rec)});
    const data=await res.json();
    alert("æäº¤æˆåŠŸï¼š"+JSON.stringify(data));
  }catch(e){alert("æäº¤å¤±è´¥ï¼š"+e.message)}
};
</script>
</body>
</html>
