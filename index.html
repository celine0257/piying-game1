<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"
  />
  <title>è…¾å†²çš®å½±æˆ Â· äº‘ä¸Šå°å‰§åœºï½œä¿¡æ¯å¡«å†™ Â· è®¡æ—¶ Â· æäº¤</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--text:#e2e8f0;--accent:#38bdf8;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
      --btn:#2563eb;--btn-hover:#1d4ed8;--ghost:#e5e7eb;--ghost-t:#0b1220;
      --ring:0 0 0 4px rgb(56 189 248 / .25)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b1220,#0b1220 30%,#111827 100%) fixed;
      color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      display:grid;place-items:start center; padding:24px;
    }
    .shell{width:min(980px,100%);margin-inline:auto}
    .card{
      background:linear-gradient(180deg,#0f172a 0%,#0b1220 100%);
      border:1px solid rgba(148,163,184,.18); border-radius:18px; padding:24px; box-shadow:0 18px 60px rgba(2,6,23,.55)
    }
    header h1{margin:0 0 8px;font-size:28px;letter-spacing:.5px}
    header p{margin:0;color:var(--muted)}
    .grid{display:grid;gap:16px}
    @media (min-width:740px){ .grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:repeat(3,1fr)} }
    label{display:block;font-size:13px;color:var(--muted);margin:6px 0}
    input,select{
      width:100%; background:#0b1220; color:var(--text);
      border:1px solid rgba(148,163,184,.3); border-radius:12px; padding:12px 14px; outline:none
    }
    input:focus,select:focus{border-color:var(--accent); box-shadow:var(--ring)}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 16px; cursor:pointer;
      color:#fff; background:var(--btn); font-weight:600
    }
    .btn:hover{background:var(--btn-hover)}
    .ghost{
      background:var(--ghost); color:var(--ghost-t); border-radius:12px; padding:12px 16px; font-weight:600; cursor:pointer; border:0
    }
    .timer{
      display:flex; align-items:center; gap:12px; padding:14px 16px; border-radius:12px;
      background:#0b1220; border:1px dashed rgba(148,163,184,.35)
    }
    .big{font-size:32px; font-weight:800; letter-spacing:1px}
    .muted{color:var(--muted)}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .hr{height:1px; background:rgba(148,163,184,.15); margin:24px 0}
    .note{font-size:14px; color:var(--muted)}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid rgba(148,163,184,.25);border-radius:999px;color:var(--muted)}
    .foot{opacity:.9}
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <header>
        <h1>è…¾å†²çš®å½±æˆ Â· äº‘ä¸Šå°å‰§åœº</h1>
        <p>å¡«å†™åŸºæœ¬ä¿¡æ¯ â†’ <b>å¼€å§‹è®¡æ—¶</b> â†’ <b>è¿›å…¥æ¸¸æˆæ¼”ç»ƒ</b>ï¼ˆåŸéŸ³æ•ˆ/å¥–åŠ±ç…§å¸¸ï¼‰â†’ è¿”å› <b>æäº¤æˆç»©</b>ï¼Œæ•°æ®ä¼šå†™å…¥é£ä¹¦è¡¨ã€‚</p>
      </header>

      <!-- ä¿¡æ¯è¡¨å• -->
      <section class="grid grid-3" style="margin-top:12px">
        <div><label>æ˜µç§°/å§“å</label><input id="name" placeholder="ä¾‹å¦‚ï¼šå°æ˜" /></div>
        <div><label>å¹´çº§</label>
          <select id="grade">
            <option value="" disabled selected>è¯·é€‰æ‹©</option>
            <option>ä¸€å¹´çº§</option><option>äºŒå¹´çº§</option><option>ä¸‰å¹´çº§</option>
            <option>å››å¹´çº§</option><option>äº”å¹´çº§</option><option>å…­å¹´çº§</option>
          </select>
        </div>
        <div><label>ç­çº§</label><input id="klass" placeholder="ä¾‹å¦‚ï¼š3ç­" /></div>
      </section>

      <section class="grid grid-3" style="margin-top:12px">
        <div><label>ç¬¬3å…³æ­¥æ•°ï¼ˆå¯é€‰ï¼‰</label><input id="moves" type="number" inputmode="numeric" min="0" placeholder="ä¾‹å¦‚ï¼š8" /></div>
        <div><label>æ˜¯å¦çœ‹è§†é¢‘ï¼ˆå•é€‰ï¼‰</label>
          <select id="vseen">
            <option value="æœªé€‰æ‹©" disabled selected>è¯·é€‰æ‹©</option>
            <option>æ˜¯</option><option>å¦</option>
          </select>
        </div>
        <div class="note" style="display:flex;align-items:flex-end">è‹¥æ‰«ç ç½‘å€å¸¦ ?grade=å…­å¹´çº§&class=3ç­&name=å¼ ä¸‰ï¼Œå¯è‡ªåŠ¨å¡«å……ã€‚</div>
      </section>

      <div class="hr"></div>

      <!-- è®¡æ—¶å™¨ -->
      <section class="grid grid-2">
        <div class="timer"><span class="muted">ç”¨æ—¶</span><span id="clock" class="big">00:00</span><span id="sec" class="muted">0 ç§’</span></div>
        <div class="row">
          <button class="ghost" id="btnStart">â–¶ å¼€å§‹</button>
          <button class="ghost" id="btnPause">â¸ æš‚åœ</button>
          <button class="ghost" id="btnReset">âŸ² å½’é›¶</button>
        </div>
      </section>

      <div class="row" style="margin-top:16px">
        <!-- è¿›å…¥æ¸¸æˆï¼šä¿ç•™åŸéŸ³æ•ˆ/å¥–åŠ±é¡µé¢ -->
        <a href="./reward.html" class="ghost" id="btnGame" style="text-decoration:none">ğŸ® è¿›å…¥æ¸¸æˆï¼ˆä¿ç•™éŸ³æ•ˆä¸å¥–åŠ±ï¼‰</a>
        <button class="btn" id="btnSubmit">âœ… æäº¤æˆç»©</button>
        <span id="tip" class="pill">çŠ¶æ€ï¼šç­‰å¾…æäº¤</span>
      </div>

      <div class="hr"></div>

      <!-- å­¦ç”Ÿè‡ªåˆ¶ä¸å±•æ¼”è¯´æ˜ -->
      <section>
        <h3 style="margin:0 0 8px">å­¦ç”Ÿè‡ªåˆ¶çš®å½±ä¸å±•æ¼”è¯´æ˜</h3>
        <ol class="note" style="margin:8px 0 0 16px">
          <li>è¯·ä½¿ç”¨èº«è¾¹ææ–™ï¼ˆçº¸æ¿ã€å¸ç®¡ã€ç¡¬å¡ï¼‰ç®€å•åˆ¶ä½œä¸€ä¸ªå°çš®å½±ï¼Œå‰ªè£æ³¨æ„å®‰å…¨ã€‚</li>
          <li>åœ¨ã€Œè¿›å…¥æ¸¸æˆã€ä¸­å­¦ä¹ åŠ¨ä½œä¸èŠ‚å¥ï¼›è¿”å›åå®Œæˆä¸€æ¬¡ 30ï½90 ç§’çš„å°å‰§åœºå±•æ¼”ï¼ˆå¯è‡ªæ‹Ÿä¸»é¢˜ï¼‰ã€‚</li>
          <li>å±•æ¼”æ—¶æ³¨æ„è‚¢ä½“èŠ‚å¥ä¸ç”»é¢æ„å›¾ï¼›ç»“æŸååœ¨æœ¬é¡µç‚¹å‡»ã€Œæäº¤æˆç»©ã€ï¼Œè€å¸ˆå¯åœ¨é£ä¹¦æŸ¥çœ‹ç»Ÿè®¡ã€‚</li>
        </ol>
      </section>

      <div class="hr"></div>
      <div class="foot note">Â© äº‘å—å¸ˆèŒƒå¤§å­¦é™„å±å°å­¦ Â· æ¨±èŠ±è¯­æ ¡åŒº</div>
    </div>
  </div>

  <script>
    // ====== é…ç½® ======
    const BACKEND = "https://piying-feishu-backend.vercel.app/api/collect"; // ä½ çš„åç«¯ Collect API
    // ====== å·¥å…· ======
    const $ = (s) => document.querySelector(s);
    const nameEl  = $("#name");
    const gradeEl = $("#grade");
    const klassEl = $("#klass");
    const movesEl = $("#moves");
    const vseenEl = $("#vseen");
    const clockEl = $("#clock");
    const secEl   = $("#sec");
    const tipEl   = $("#tip");

    // è§£æ URL å‚æ•°è‡ªåŠ¨å¡«å……
    (function autofill(){
      const p = new URLSearchParams(location.search);
      if (p.get("name"))  nameEl.value  = decodeURIComponent(p.get("name"));
      if (p.get("grade")) gradeEl.value = decodeURIComponent(p.get("grade"));
      if (p.get("class")) klassEl.value = decodeURIComponent(p.get("class"));
      if (p.get("vseen")) vseenEl.value = decodeURIComponent(p.get("vseen")) === "true" ? "æ˜¯"
                          : decodeURIComponent(p.get("vseen")) === "false" ? "å¦"
                          : decodeURIComponent(p.get("vseen"));
      if (p.get("autostart") === "1") start();
    })();

    // è‰ç¨¿æœ¬åœ°å­˜å‚¨ï¼Œé˜²ä¸¢
    const KEY = "piying_form_draft_v1";
    (function loadDraft(){
      try{
        const d = JSON.parse(localStorage.getItem(KEY)||"{}");
        if(d.name)  nameEl.value = d.name;
        if(d.grade) gradeEl.value = d.grade;
        if(d.klass) klassEl.value = d.klass;
        if(d.moves!=null) movesEl.value = d.moves;
        if(d.vseen) vseenEl.value = d.vseen;
      }catch{}
    })();
    function saveDraft(){
      const d = {
        name: nameEl.value.trim(),
        grade: gradeEl.value,
        klass: klassEl.value.trim(),
        moves: movesEl.value ? Number(movesEl.value) : "",
        vseen: vseenEl.value
      };
      localStorage.setItem(KEY, JSON.stringify(d));
    }
    [nameEl,gradeEl,klassEl,movesEl,vseenEl].forEach(el=>el.addEventListener("change",saveDraft));

    // è®¡æ—¶å™¨
    let timer=null, seconds=0;
    function fmt(sec){ const m=Math.floor(sec/60), s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
    function paint(){ clockEl.textContent = fmt(seconds); secEl.textContent = `${seconds} ç§’`; }
    function start(){ if(timer) return; timer=setInterval(()=>{ seconds++; paint(); },1000); tip("è®¡æ—¶ä¸­â€¦","warn"); }
    function pause(){ if(timer){ clearInterval(timer); timer=null; tip("å·²æš‚åœ","muted"); } }
    function reset(){ pause(); seconds=0; paint(); tip("è®¡æ—¶å·²å½’é›¶","muted"); }

    $("#btnStart").onclick = start;
    $("#btnPause").onclick = pause;
    $("#btnReset").onclick = reset;

    // æäº¤
