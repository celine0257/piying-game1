<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>è…¾å†²çš®å½±æˆ Â· éé—æ¢ç§˜é—¯å…³</title>
<style>
:root{--bg:#0b1220;--card:#0f172a;--ink:#e5e7eb;--muted:#9ca3af;--brand:#60a5fa;--ok:#34d399;--warn:#f59e0b}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,"PingFang SC","Microsoft YaHei";background:var(--bg);color:var(--ink)}
.wrap{max-width:1100px;margin:0 auto;padding:18px}
.card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:14px}
h1,h2{margin:0 0 12px}.muted{color:var(--muted);font-size:14px}
input,select,button{border-radius:12px;border:1px solid #1f2937;padding:10px 12px;background:#0b1220;color:#fff}
button{background:var(--brand);color:#09111f;font-weight:700;cursor:pointer;border:none}
button.ghost{background:#0b1220;color:#fff;border:1px solid #374151}
button:disabled{opacity:.5;cursor:not-allowed}
.topbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.badge{font-size:12px;background:#0b1220;border:1px solid #374151;padding:2px 10px;border-radius:999px;color:#cbd5e1}
.progress{display:flex;gap:4px;align-items:center}.dot{width:10px;height:10px;border-radius:50%;background:#1f2937}.dot.on{background:linear-gradient(180deg,#a7f3d0,#10b981)}
.gallery{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.gallery img{width:100%;height:240px;object-fit:cover;border-radius:12px;border:1px solid #374151}
.gallery .span2{grid-column:1/span 2;height:280px}
.cap{font-size:12px;color:#cbd5e1;margin:6px 2px 0}
.timeline{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:10px}
.stepSlot{min-height:72px;display:flex;align-items:center;justify-content:center;border:2px dashed #374151;border-radius:12px;color:#94a3b8;background:#0b1220}
.stepSlot.locked{opacity:.6;filter:grayscale(30%)}.stepSlot.active{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.3) inset}
.part{user-select:none;margin:8px 0;padding:10px 12px;background:#0f172a;border:1px solid #1f2937;border-radius:12px;cursor:grab}
.partsBox{background:#0b1220;border:1px solid #374151;border-radius:16px;padding:12px}
.good{outline:2px solid var(--ok)}.warn{outline:2px solid var(--warn)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.info{background:#0b1220;border:1px solid #374151;border-radius:14px;padding:12px;cursor:pointer}
.info .title{font-weight:700;margin-bottom:6px}.info .content{display:none;font-size:13px;color:#cbd5e1}
.info.learned{outline:2px solid var(--ok)}
.board{--cols:4;display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:10px}
.cardtile{height:90px;background:#0b1220;border:1px solid #374151;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700}
.cardtile.open{background:linear-gradient(135deg,#0b1220,#0f172a)}
.videoWrap{background:#0b1220;border:1px solid #374151;border-radius:16px;padding:12px}
video{width:100%;border-radius:12px;background:#000}
table{width:100%;border-collapse:collapse;font-size:14px;margin-top:8px}
th,td{border-bottom:1px solid #223;padding:8px;text-align:left}
.footer{font-size:12px;color:#9ca3af;text-align:center;margin-top:8px}
@keyframes shakeX{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-6px)}40%,60%{transform:translateX(6px)}}.shake{animation:shakeX .35s ease}
@media (max-width:900px){.board{--cols:3}}
</style>
</head>
<body>
<div class="wrap">

  <!-- é¡¶éƒ¨ -->
  <div class="card">
    <h1>è…¾å†²çš®å½±æˆ Â· éé—æ¢ç§˜é—¯å…³</h1>
    <p class="muted">â‘ åˆ¶ä½œæ­¥éª¤ â†’ â‘¡è¯æ¡å­¦ä¹  â†’ â‘¢è®°å¿†é…å¯¹ï¼ˆ6å¯¹ï¼‰ â†’ â‘£å¥–åŠ±è§†é¢‘ã€‚é€šå…³åç”Ÿæˆå‹‹ç« å¹¶è®¡å…¥æ’è¡Œæ¦œï¼Œå¹¶ä¸Šä¼ åˆ°ä½ çš„ Google è¡¨æ ¼ã€‚</p>
    <div class="topbar">
      <label>æ˜µç§° <input id="name" placeholder="å¦‚ï¼šäº”ï¼ˆä¸‰ï¼‰-29"></label>
      <label>å¹´çº§ <select id="grade"><option value="">è¯·é€‰æ‹©</option><option>ä¸€å¹´çº§</option><option>äºŒå¹´çº§</option><option>ä¸‰å¹´çº§</option><option>å››å¹´çº§</option><option>äº”å¹´çº§</option><option>å…­å¹´çº§</option></select></label>
      <label>ç­çº§ <input id="klass" placeholder="å¦‚ï¼šäº”ï¼ˆä¸‰ï¼‰ç­"></label>
      <label>åŒæ„åŒ¿åæ•°æ® <select id="consent"><option>æ˜¯</option><option>å¦</option></select></label>
      <span class="badge">ç”¨æ—¶ï¼š<span id="time">0</span>s</span>
      <div class="progress"><span class="badge">è¿›åº¦</span><span class="dot" id="d1"></span><span class="dot" id="d2"></span><span class="dot" id="d3"></span><span class="dot" id="d4"></span></div>
      <button id="start">å¼€å§‹</button>
      <button id="reset" class="ghost" disabled>é‡æ¥</button>
      <button id="export" class="ghost">å¯¼å‡ºå…¨éƒ¨CSV</button>
    </div>
  </div>

  <!-- â€¦â€¦å‰é¢å…³å¡å†…å®¹æˆ‘çœç•¥ï¼Œå’Œä½ ç°æœ‰çš„ä¸€è‡´â€¦â€¦ -->

<script>
/*** âœ… å·²æ›¿æ¢æˆä½ çš„ Google è¡¨æ ¼åœ°å€ ***/
const CLOUD_ENDPOINT = "https://script.google.com/macros/s/AKfycbx64Nh1_ytVTe1iVQGRcuVSibAApsKKUE_l2uHHfDN9mltufAQxJu24247daL8s0iex/exec";

/* â€¦â€¦ è¿™é‡Œä¿ç•™ä¹‹å‰çš„æ‰€æœ‰æ¸¸æˆé€»è¾‘ã€å…³å¡ã€å‹‹ç« ä»£ç  â€¦â€¦ */

/* â€”â€” åœ¨ finalize çš„æ—¶å€™ä¸Šä¼  â€”â€” */
$("#finalize").onclick=async ()=>{
  stopTimer(); setDot(4);
  const rec={
    timestamp:new Date().toISOString(),
    name: ($("#name").value||"").replace(/,/g," "),
    grade: $("#grade").value,
    class: ($("#klass").value||"").replace(/,/g," "),
    time_sec: timeSec,
    l3_moves: Number($("#moves3").textContent)||0,
    v_seen: v_seen
  };

  // æœ¬åœ°å­˜æ¡£ + åˆ·æ–°æ¦œå•
  saveRecord(rec); refreshBoard();

  // â€”â€” ä¸Šä¼ åˆ° Google è¡¨æ ¼ â€”â€”  
  try{
    await fetch(CLOUD_ENDPOINT, {
      method:"POST",
      body: JSON.stringify(rec)
    });
  }catch(e){
    console.warn("ä¸Šä¼ äº‘ç«¯å¤±è´¥ï¼š", e);
  }

  alert(`ğŸ‰ æ­å–œé€šå…³ï¼\nç”¨æ—¶ï¼š${rec.time_sec}s\næ•°æ®å·²ä¸Šä¼ åˆ° Google è¡¨æ ¼ã€‚`);

  // â€¦â€¦è¿™é‡Œç»§ç»­ç”Ÿæˆå‹‹ç«  & CSV çš„é€»è¾‘â€¦â€¦
};
</script>
</body>
</html>